{
	"name": "1_explore_vehicle",
	"properties": {
		"folder": {
			"name": "electric_vechicle/explorer"
		},
		"content": {
			"query": "-- This is auto-generated code\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://synapsecourseespdl.dfs.core.windows.net/electric-vehicle-data/bronze/vehicle.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0'\n    ) AS [result]\n\n\n\n\n--Segunda Manera de realizar la consulta con abfss\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n    ) AS [result]\n\n--Examinar el data type de las columnas Para limitar las columnas varchar a un tamaño menor\nEXEC sp_describe_first_result_set N'SELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK ''abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle.csv'',\n        FORMAT = ''CSV'',\n        PARSER_VERSION = ''2.0'',\n        HEADER_ROW = TRUE\n        ) AS [result];'\n\n--Obtener la longitud maxima de las columnas \nSELECT\n   MAX(LEN(vehicleId)) AS vehicle_id,\n   MAX(LEN(vin)) AS vin,\n   MAX(LEN(modelYear)) AS model_year,\n   MAX(LEN(make)) AS make,\n   MAX(LEN(model)) AS model,\n   MAX(LEN(electricRange)) AS electric_range,\n   MAX(LEN(baseMSRP)) AS base_MSRP,\n   MAX(LEN(vehicheTypeId)) AS vehiche_type_id,\n   MAX(LEN(cafvEligibilityId)) AS cafv_eligibility_id,\n   MAX(LEN(vehicleLocation)) AS vehicle_location\nFROM\n    OPENROWSET(\n        BULK 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n        ) AS [result]\n\n--Dentro del With colocamos el datatype que deseamos asignar en la consulta\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n    )   WITH (\n        \n                vehicle_id          INT 1,\n                vin                 VARCHAR(10) 2,\n                modelYear           SMALLINT 3,\n                make                VARCHAR(25) 4,\n                model               VARCHAR(25) 5,\n                electricRange       SMALLINT 6,\n                baseMSRP            INT 7,\n                vehicleTypeId       SMALLINT 8,\n                cafvEligibilityId   SMALLINT 9,\n                vehicleLocation     VARCHAR(30) 10\n    )     AS [result];\n\n\n ---Para comprobar el cambio \n EXEC sp_describe_first_result_set N'SELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK ''abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle.csv'',\n        FORMAT = ''CSV'',\n        PARSER_VERSION = ''2.0'',\n        HEADER_ROW = TRUE\n    )   WITH (\n        \n                vehicleId           INT,\n                vin                 VARCHAR(10),\n                modelYear           SMALLINT,\n                make                VARCHAR(25),\n                model               VARCHAR(25),\n                electricRange       SMALLINT,\n                baseMSRP            INT,\n                vehicheTypeId       SMALLINT,\n                cafvEligibilityId   SMALLINT,\n                vehicleLocation     VARCHAR(30)\n    )\n     AS [result];'\n\n--Revisar Collation \nSelect name, collation_name\nFROM sys.databases;\n\n--Especificar UTF-8 Collation para columnas VARCHAR en una consulta\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n    )   WITH (\n        \n                vehicleId           INT,\n                vin                 VARCHAR(10) COLLATE Latin1_General_100_CI_AI_SC_UTF8,\n                modelYear           SMALLINT,\n                make                VARCHAR(25) COLLATE Latin1_General_100_CI_AI_SC_UTF8,\n                model               VARCHAR(25) COLLATE Latin1_General_100_CI_AI_SC_UTF8,\n                electricRange       SMALLINT,\n                baseMSRP            INT,\n                vehicheTypeId       SMALLINT,\n                cafvEligibilityId   SMALLINT,\n                vehicleLocation     VARCHAR(30) COLLATE Latin1_General_100_CI_AI_SC_UTF8\n    )\n     AS [result];\n\n\n--Especificar UTF-8 Collation a Nivel de DB\n\nCREATE DATABASE electric_vehicle_explorer;\nUSE electric_vehicle_explorer\n\nSelect name, collation_name\nFROM sys.databases;\n\nALTER DATABASE electric_vehicle_explorer COLLATE Latin1_General_100_CI_AI_SC_UTF8;\n\n\n--Seleccionar solo las columnas necesarias \nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n    )   WITH (\n                       \n                vin                 VARCHAR(10),\n                modelYear           SMALLINT,\n                make                VARCHAR(25), \n                model               VARCHAR(25), \n                electricRange       SMALLINT,\n                baseMSRP            INT               \n    )\n     AS [result];\n\n\n--Leer data de un archivo sin Headers\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/vehicle_without_header.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0'\n    )   WITH (\n                       \n                vin                 VARCHAR(10) 2,\n                make                VARCHAR(25) 4, \n                model               VARCHAR(25) 5\n                         \n    )\n     AS [result];\n\n-- Crear el External Data Source\nCREATE EXTERNAL DATA SOURCE electric_vehicle_data\nWITH(\n    LOCATION = 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/'\n);\n\nCREATE EXTERNAL DATA SOURCE electric_vehicle_data_bronze\nWITH(\n    LOCATION = 'abfss://electric-vehicle-data@synapsecourseespdl.dfs.core.windows.net/bronze/'\n);\n\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'vehicle.csv',\n        DATA_SOURCE = 'electric_vehicle_data_bronze',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        FIRSTROW = 2\n    )   WITH (\n        \n                vehicleId           INT,\n                vin                 VARCHAR(10),\n                modelYear           SMALLINT,\n                make                VARCHAR(25),\n                model               VARCHAR(25),\n                electricRange       SMALLINT,\n                baseMSRP            INT,\n                vehicheTypeId       SMALLINT,\n                cafvEligibilityId   SMALLINT,\n                vehicleLocation     VARCHAR(30)\n    )\n     AS [result];\n\n     DROP EXTERNAL DATA SOURCE electric_vehicle_data;\n\n     Select name, location from sys.external_data_sources;\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "electric_vehicle_explorer",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}