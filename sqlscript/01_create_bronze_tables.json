{
	"name": "01_create_bronze_tables",
	"properties": {
		"folder": {
			"name": "electric_vechicle/ldw/virtualization"
		},
		"content": {
			"query": "USE electric_vehicle_ldw;\n\n--Create \"Vehicle\" Table\nIF OBJECT_ID('bronze.vehicle') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.vehicle\n\nCREATE EXTERNAL TABLE bronze.vehicle\n            (\n                vehicle_id            INT ,\n                vin                   VARCHAR(10) ,\n                model_year            SMALLINT ,\n                make                  VARCHAR(25) ,\n                model                 VARCHAR(25) ,\n                electric_range        SMALLINT ,\n                base_MSRP             INT ,\n                vehicle_type_id       SMALLINT ,\n                cafv_eligibility_id   SMALLINT ,\n                vehicle_location      VARCHAR(30) \n            )\n     WITH (\n        LOCATION = 'bronze/vehicle.csv',\n        DATA_SOURCE = electric_vehicle_src,\n        FILE_FORMAT = csv_file_format,\n        REJECT_VALUE = 10,\n        REJECTED_ROW_LOCATION = 'rejections/vehicle'\n         \n    );\n    \n\n\n  select * from bronze.vehicle\n\n  --Create \"calendar\" Table\n  IF OBJECT_ID('bronze.calendar') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.calendar\n\n    CREATE EXTERNAL TABLE bronze.calendar\n    (\n            date_key        INT , \n            date            DATE , \n            year            SMALLINT , \n            month           TINYINT , \n            day             TINYINT , \n            month_name      VARCHAR(10) , \n            day_name        VARCHAR(10) ,\n            day_of_year     SMALLINT ,\n            week_of_month   TINYINT , \n            week_of_year    TINYINT \n    )\n     WITH (\n        LOCATION = 'bronze/calendar.csv',\n        DATA_SOURCE = electric_vehicle_src,\n        FILE_FORMAT = csv_file_format_v2,\n        REJECT_VALUE = 10,\n        REJECTED_ROW_LOCATION = 'rejections/calendar'\n    );\n    \n    SELECT * FROM bronze.calendar\n\n  --Create \"location\" Table\n  IF OBJECT_ID('bronze.location') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.location\n\n    CREATE EXTERNAL TABLE bronze.location\n    (\n            location_id                 SMALLINT,\n            country                     VARCHAR(30),\n            city                        VARCHAR(30),\n            state                       VARCHAR(30),\n            postal_code                 VARCHAR(5),\n            legislative_district        VARCHAR(2),\n            census_tract                VARCHAR(11)\n    )\n     WITH (\n        LOCATION = 'bronze/location.csv',\n        DATA_SOURCE = electric_vehicle_src,\n        FILE_FORMAT = csv_file_format_v3,\n        REJECT_VALUE = 10,\n        REJECTED_ROW_LOCATION = 'rejections/location'\n    );\n    \n    SELECT * FROM bronze.location\n\n  --Create \"propietary\" Table\n  IF OBJECT_ID('bronze.propietary') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.propietary\n\n    CREATE EXTERNAL TABLE bronze.propietary\n    (\n            propietary_id       TINYINT,\n            electric_utility    VARCHAR(120)\n    )\n     WITH (\n        LOCATION = 'bronze/propietary.tsv',\n        DATA_SOURCE = electric_vehicle_src,\n        FILE_FORMAT = tsv_file_format,\n        REJECT_VALUE = 10,\n        REJECTED_ROW_LOCATION = 'rejections/propietary'\n    );\n    \n    SELECT * FROM bronze.propietary;\n\n\n  --Create \"vehicle_registration_csv\" Table\n  IF OBJECT_ID('bronze.vehicle_registration_csv') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.vehicle_registration_csv\n\n    CREATE EXTERNAL TABLE bronze.vehicle_registration_csv\n    (\n            vehicle_id          INT,\n            location_id         SMALLINT,\n            propietary_id       TINYINT,\n            dol_vehicle_id      INT,\n            registration_date   DATETIME2(7)\n    )\n     WITH (\n        LOCATION = 'bronze/vehicle_registration_csv/**',\n        DATA_SOURCE = electric_vehicle_src,\n        FILE_FORMAT = csv_file_format,\n        REJECT_VALUE = 10,\n        REJECTED_ROW_LOCATION = 'rejections/vehicle_registration_csv'\n    );\n    \n    SELECT TOP 100 *\n    FROM bronze.vehicle_registration_csv\n    WHERE YEAR(registration_date) = 2025 and month(registration_date)= 2;\n\n\n--Create \"vehicle_registration_parquet\" Table\n  IF OBJECT_ID('bronze.vehicle_registration_parquet') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.vehicle_registration_parquet\n\n    CREATE EXTERNAL TABLE bronze.vehicle_registration_parquet\n    (\n            vehicleId          INT,\n            locationId         SMALLINT,\n            propietaryId       TINYINT,\n            dolVehicleId       INT,\n            registrationDate   DATETIME2(7)\n    )\n     WITH (\n        LOCATION = 'bronze/vehicle_registration_parquet/**',\n        DATA_SOURCE = electric_vehicle_src,\n        FILE_FORMAT = parquet_file_format,\n     );\n    \n    SELECT TOP 100 *\n    FROM bronze.vehicle_registration_parquet\n   \n\n--Create \"vehicle_registration_delta\" Table\n  IF OBJECT_ID('bronze.vehicle_registration_delta') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.vehicle_registration_delta\n\n    CREATE EXTERNAL TABLE bronze.vehicle_registration_delta\n    (\n            vehicleId          INT,\n            locationId         SMALLINT,\n            propietaryId       TINYINT,\n            dolVehicleId       INT,\n            registrationDate   DATETIME2(7)\n    )\n     WITH (\n        LOCATION = 'bronze/vehicle_registration_delta',\n        DATA_SOURCE = electric_vehicle_src,\n        FILE_FORMAT = delta_file_format,\n     );\n    \n    SELECT TOP 100 *\n    FROM bronze.vehicle_registration_delta\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "electric_vehicle_ldw",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}